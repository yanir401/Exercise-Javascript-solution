const carMarket = {
  sellers: [
    {
      agencyName: "Best Deal",
      cash: 1245000,
      credit: 200000,
      agencyId: "Plyq5M5AZ",
      cars: [
        {
          brand: "bmw",
          models: [
            {
              name: "3",
              year: 2015,
              price: 137000,
              carNumber: "AZJZ4",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "X6",
              year: 2020,
              price: 966500,
              carNumber: "S6DL1",
              ownerId: "Plyq5M5AZ",
            },
          ],
        },
        {
          brand: "toyota",
          models: [
            {
              name: "Land Cruiser",
              year: 2020,
              price: 336300,
              carNumber: "6rvXw",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Hilux",
              year: 2005,
              price: 35005,
              carNumber: "MWXBG",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Corolla",
              year: 2020,
              price: 111900,
              carNumber: "hCzl-",
              ownerId: "Plyq5M5AZ",
            },
          ],
        },
        {
          brand: "Ford",
          models: [
            {
              name: "Focus",
              year: 2020,
              price: 98200,
              carNumber: "kN3HP",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Focus",
              year: 2005,
              price: 6502,
              carNumber: "LJTCs",
              ownerId: "Plyq5M5AZ",
            },
          ],
        },
        {
          brand: "Alpha romeo",
          models: [
            {
              name: "Romeo Julia",
              year: 2020,
              price: 275406,
              carNumber: "2kjy7",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Romeo Stelvio",
              year: 2019,
              price: 215403,
              carNumber: "7A5b-",
              ownerId: "Plyq5M5AZ",
            },
          ],
        },
        {
          brand: "Chevrolet",
          models: [
            {
              name: "Traverse",
              year: 2020,
              price: 201102,
              carNumber: "QwBOT",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Impala",
              year: 2019,
              price: 165041,
              carNumber: "2v4jt",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Malibu",
              year: 2017,
              price: 75405,
              carNumber: "O4_Jv",
              ownerId: "Plyq5M5AZ",
            },
          ],
        },
      ],
    },
    {
      agencyName: "CarMax",
      cash: 968541,
      credit: 500000,
      agencyId: "26_IPfHU1",
      cars: [
        {
          brand: "bmw",
          models: [
            {
              name: "X5",
              year: 2015,
              price: 218000,
              carNumber: "4Ixb0",
              ownerId: "26_IPfHU1",
            },
            {
              name: "X6",
              year: 2014,
              price: 97100,
              carNumber: "kAnv-",
              ownerId: "26_IPfHU1",
            },
            {
              name: "Z4",
              year: 2019,
              price: 296900,
              carNumber: "ISMdU",
              ownerId: "26_IPfHU1",
            },
            {
              name: "3",
              year: 2010,
              price: 75100,
              carNumber: "9DJPw",
              ownerId: "26_IPfHU1",
            },
          ],
        },
        {
          brand: "toyota",
          models: [
            {
              name: "Land Cruiser",
              year: 2005,
              price: 80540,
              carNumber: "Kt-pW",
              ownerId: "26_IPfHU1",
            },
            {
              name: "Corolla",
              year: 2019,
              price: 109100,
              carNumber: "YiYdI",
              ownerId: "26_IPfHU1",
            },
            {
              name: "Hilux",
              year: 2019,
              price: 204000,
              carNumber: "DRmNw",
              ownerId: "26_IPfHU1",
            },
          ],
        },
        {
          brand: "Ford",
          models: [
            {
              name: "F250",
              year: 2020,
              price: 198500,
              carNumber: "g4Wfp",
              ownerId: "26_IPfHU1",
            },
            {
              name: "Explorer",
              year: 2020,
              price: 265200,
              carNumber: "iNT8Q",
              ownerId: "26_IPfHU1",
            },
          ],
        },
        {
          brand: "Alpha romeo",
          models: [
            {
              name: "Spider",
              year: 2011,
              price: 75405,
              carNumber: "6t7QU",
              ownerId: "26_IPfHU1",
            },
            {
              name: "166",
              year: 2002,
              price: 12400,
              carNumber: "XMqpn",
              ownerId: "26_IPfHU1",
            },
          ],
        },
        {
          brand: "Chevrolet",
          models: [
            {
              name: "Impala",
              year: 2016,
              price: 65042,
              carNumber: "vbeAo",
              ownerId: "26_IPfHU1",
            },
            {
              name: "Savannah",
              year: 2016,
              price: 76505,
              carNumber: "WelWa",
              ownerId: "26_IPfHU1",
            },
          ],
        },
      ],
    },
    {
      agencyName: "The Auto World",
      cash: 687450,
      credit: 200000,
      agencyId: "gNHjNFL12",
      cars: [
        {
          brand: "bmw",
          models: [
            {
              name: "X6",
              year: 2018,
              price: 548100,
              carNumber: "EMW_7",
              ownerId: "gNHjNFL12",
            },
            {
              name: "3",
              year: 2017,
              price: 178000,
              carNumber: "XlnB4",
              ownerId: "gNHjNFL12",
            },
          ],
        },
        {
          brand: "toyota",
          models: [
            {
              name: "Prius",
              year: 2017,
              price: 101542,
              carNumber: "-RQgN",
              ownerId: "gNHjNFL12",
            },
            {
              name: "Highlander",
              year: 2017,
              price: 202540,
              carNumber: "AZJZ4",
              ownerId: "gNHjNFL12",
            },
            {
              name: "Corolla",
              year: 1996,
              price: 5420,
              carNumber: "kHE8f",
              ownerId: "gNHjNFL12",
            },
            {
              name: "Corolla",
              year: 2012,
              price: 40570,
              carNumber: "p2qEi",
              ownerId: "gNHjNFL12",
            },
          ],
        },
        {
          brand: "Ford",
          models: [
            {
              name: "Explorer",
              year: 2014,
              price: 127502,
              carNumber: "Ty1zN",
              ownerId: "gNHjNFL12",
            },
            {
              name: "F350",
              year: 2012,
              price: 54250,
              carNumber: "z03H2",
              ownerId: "gNHjNFL12",
            },
          ],
        },
        {
          brand: "Chevrolet",
          models: [
            {
              name: "Savannah",
              year: 2010,
              price: 36504,
              carNumber: "RXFZe",
              ownerId: "gNHjNFL12",
            },
            {
              name: "Malibu",
              year: 2009,
              price: 19585,
              carNumber: "K5IsM",
              ownerId: "gNHjNFL12",
            },
          ],
        },
      ],
    },
    {
      agencyName: "Car Werks",
      cash: 302502,
      credit: 150000,
      agencyId: "9KeaYbRLP",
      cars: [
        {
          brand: "bmw",
          models: [
            {
              name: "8",
              year: 2020,
              price: 942500,
              carNumber: "4IUMz",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "X6",
              year: 2010,
              price: 129000,
              carNumber: "Vw0fV",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "X3",
              year: 2019,
              price: 358100,
              carNumber: "ufN54",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "3",
              year: 2020,
              price: 389100,
              carNumber: "F127X",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "3",
              year: 2002,
              price: 18400,
              carNumber: "ueZUp",
              ownerId: "9KeaYbRLP",
            },
          ],
        },
        {
          brand: "toyota",
          models: [
            {
              name: "Prius",
              year: 2011,
              price: 38520,
              carNumber: "AZJZ4",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "Land Cruiser",
              year: 2019,
              price: 290040,
              carNumber: "AZJZ4",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "Hilux",
              year: 2020,
              price: 215700,
              carNumber: "xig8N",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "Hilux",
              year: 2015,
              price: 178506,
              carNumber: "ghTiQ",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "Corolla",
              year: 2002,
              price: 8504,
              carNumber: "Mvw8T",
              ownerId: "9KeaYbRLP",
            },
          ],
        },
        {
          brand: "Chevrolet",
          models: [
            {
              name: "Impala",
              year: 2005,
              price: 9320,
              carNumber: "BZpkt",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "Malibu",
              year: 2002,
              price: 4502,
              carNumber: "KqKV_",
              ownerId: "9KeaYbRLP",
            },
          ],
        },
      ],
    },
    {
      agencyName: "Carsova",
      cash: 72450,
      credit: 50000,
      agencyId: "oqQmsZoUo",
      cars: [
        {
          brand: "bmw",
          models: [
            {
              name: "7",
              year: 1999,
              price: 24700,
              carNumber: "sZrjp",
              ownerId: "oqQmsZoUo",
            },
            {
              name: "3",
              year: 2008,
              price: 54000,
              carNumber: "da88K",
              ownerId: "oqQmsZoUo",
            },
          ],
        },
        {
          brand: "toyota",
          models: [
            {
              name: "Prius",
              year: 2019,
              price: 124050,
              carNumber: "ZfbqH",
              ownerId: "oqQmsZoUo",
            },
            {
              name: "Hilux",
              year: 1996,
              price: 11540,
              carNumber: "AZJZ4",
              ownerId: "oqQmsZoUo",
            },
          ],
        },
      ],
    },
  ],
  customers: [
    {
      name: "Lilah Goulding",
      id: "BGzHhjnE8",
      cars: [
        {
          name: "Corolla",
          year: 2013,
          price: 40570,
          carNumber: "16da1",
          ownerId: "BGzHhjnE8",
        },
      ],
      cash: 35000,
    },
    {
      name: "Ravi Murillo",
      id: "2RprZ1dbL",
      cars: [
        {
          name: "M5",
          year: 2019,
          price: 578054,
          carNumber: "WIh0U",
          ownerId: "2RprZ1dbL",
        },
        {
          name: "Spider",
          year: 2012,
          price: 81520,
          carNumber: "RLS4q",
          ownerId: "2RprZ1dbL",
        },
      ],
      cash: 278542,
    },
    {
      name: "Aleksander Carr",
      id: "pAuFtn_WA",
      cars: [
        {
          name: "Highlander",
          year: 2018,
          price: 214503,
          carNumber: "2WU_y",
          ownerId: "pAuFtn_WA",
        },
      ],
      cash: 125402,
    },
    {
      name: "Lana Edge",
      id: "cnTobUDy6",
      cars: [
        {
          name: "F250",
          year: 2020,
          price: 198500,
          carNumber: "Xxcy_",
          ownerId: "cnTobUDy6",
        },
        {
          name: "Hilux",
          year: 2005,
          price: 35005,
          carNumber: "VSCUj",
          ownerId: "cnTobUDy6",
        },
      ],
      cash: 7000,
    },
    {
      name: "Nikita Philip",
      id: "5x2tMcX4R",
      cars: [
        {
          name: "Impala",
          year: 2016,
          price: 65042,
          carNumber: "LKInp",
          ownerId: "5x2tMcX4R",
        },
      ],
      cash: 40541,
    },
    {
      name: "Bob Steel",
      id: "Wm6BkA1F0",
      cars: [],
      cash: 15732,
    },
    {
      name: "Will Reyes",
      id: "FQvNsEwLZ",
      cars: [
        { name: "X6", year: 2020, price: 966500, ownerId: "FQvNsEwLZ" },
        {
          name: "Land Cruiser",
          year: 2020,
          price: 336300,
          carNumber: "vaJvd",
          ownerId: "FQvNsEwLZ",
        },
        {
          name: "Romeo Julia",
          year: 2020,
          price: 275406,
          carNumber: "qLoYR",
          ownerId: "FQvNsEwLZ",
        },
        {
          name: "Explorer",
          year: 2020,
          price: 265200,
          carNumber: "tlGRq",
          ownerId: "FQvNsEwLZ",
        },
      ],
      cash: 1547242,
    },
  ],
  taxesAuthority: {
    totalTaxesPaid: 0,
    sumOfAllTransactions: 0,
    numberOfTransactions: 0,
  },
};

//! agency's func's
//todo getters

//* getAgencyByName
//? @param {string} - name
//? @return {Object} - agency object

carMarket.getAgencyByName = function (name) {
  if (typeof name == "string" && name.length > 0) {
    const result = this.sellers.find((agency) => agency.agencyName === name);
    return result;
  }
  return "Name must be a string and not empty";
};

//* getAgencyIdByName
//? @param {String} - name
//? @return {String} - agencyId

carMarket.getAgencyIdByName = function (name) {
  const result = carMarket.getAgencyByName(name);
  return result ? result.agencyId : `The agency "${name}" not found`;
  //Also can => return result && result.agencyId;
};
// console.log(carMarket.getAgencyIdByName("Bet Deal"));

//* getAllAgenciesName
//? @param {}
//? @return {string[]} - agenciesNameArr - Array of all agencies name

carMarket.getAllAgenciesName = function () {
  const agenciesNameArray = [];
  for (const agency of this.sellers) {
    agenciesNameArray.push(agency.agencyName);
  }
  return agenciesNameArray;
};
// console.log(carMarket.getAllAgenciesName());
//* getAllCarToBuy
//? @param {}
//? @return {object[]} - allCarsToBuy - arrays of all cars objects

carMarket.allCarsToBuy = function () {
  const allCars = [];
  for (const agency of this.sellers) {
    // allCars.push(agency.cars);
    agency.cars.forEach((carBrand) => {
      allCars.push(carBrand);
      // console.log(carBrand);
      // carBrand.models.forEach((car) => allCars.push(car));
    });
  }
  return allCars;
};
// console.log(carMarket.allCarsToBuy());

///getAgencyById

carMarket.getAgencyById = function (id) {
  if (typeof id === "string" && id.length > 0)
    return this.sellers.find((agency) => agency.agencyId === id);
};

//* getAllCarToBuyByAgencyId
//? @param {string} - id of agency
//? @return {object[]} - carsArray - arrays of all models objects of specific agency

carMarket.getAllCarToBuyByAgencyId = function (id) {
  const allCarToBuy = [];

  const agency = carMarket.getAgencyById(id);
  agency.cars.forEach((e) => allCarToBuy.push(e.models));
  return allCarToBuy;
};

carMarket.getAllCarToBuyByAgencyId("Plyq5M5AZ");
//* getAllBrandsToBuyAgencyId
//? @param {string} - agencyId -  id of agency
// ? @return {string[]} - arrOfBrands - arrays of all brands name in specific agency

carMarket.getAllBrandsToBuyAgencyId = function (id) {
  const agency = carMarket.getAgencyById(id);
  if (agency) {
    return agency.cars.map((e) => {
      return e.brand;
    });
  }
  return "Please check your agency id";
};

// console.log(carMarket.getAllBrandsToBuyAgencyId("Plyq5M5AZ"));

//! customer func's
//todo getters
//* getCustomerByName
//? @param {string} - name
//? @return {Object} - customer

carMarket.getCustomerByName = function (name) {
  const result = this.customers.find((customer) => customer.name === name);
  return result ? result : "Invalid Name";
};

// console.log(carMarket.getCustomerByName("Lilah Goulding"));

//* getCustomerIdByName
//? @param {name}
//? @return {String} - customerId - The customer id

carMarket.getCustomerIdByName = function (name) {
  const customerName = carMarket.getCustomerByName(name);
  return customerName ? customerName.id : "Invalid Name";
};

// console.log(carMarket.getCustomerIdByName("Ravi Murillo"));

//* getAllCustomersNames
//? @param {}
//? @return {string[]} - customersNameArr -  Array of all customers name

carMarket.getAllCustomersNames = function () {
  return this.customers.map((customer) => customer.name);
};

// console.log(carMarket.getAllCustomersNames());

//getCustomerById
carMarket.getCustomerById = function (id) {
  const result = this.customers.find((customer) => customer.id === id);
  return result ? result : "Invalid Id";
};

// console.log(carMarket.getCustomerById("BGzHhjnE8"));

//* getAllCustomerCars
//? @param {id} - costumerId - costumer id
//? @return {object[]} - customerCarsArr -  Array of all customer cars object

carMarket.getAllCustomerCars = function (id) {
  return carMarket.getCustomerById(id).cars;
};

// console.log(carMarket.getAllCustomerCars("2RprZ1dbL"));

//* getCustomerCash
//? @param {id} - costumerId - costumer id
//? @return {number} - CustomerCash

carMarket.getCustomerCash = function (id) {
  return carMarket.getCustomerById(id).cash;
};

// console.log(carMarket.getCustomerCash("2RprZ1dbL"));
//!------------------------------------------------------------

//*  1) setPropertyBrandToAllCars
//? set all cars model object the current brand
//? @param {}
//? @return {}

carMarket.setPropertyBrandToAllCars = function () {
  const allCars = carMarket.allCarsToBuy();

  allCars.forEach((e) => {
    const currentBrand = e.brand;
    e.models.forEach((e) => {
      e.brand = currentBrand;
    });
  });

  // for (car of allCars) {
  //   console.log(allCars);
  // }

  // for (agency of this.sellers) {
  //   for (car of agency.cars) {
  //     console.log(car.models);
  //   }
  // }
};
carMarket.setPropertyBrandToAllCars();
//todo Agency setters

//* setNewCarToAgency
//? @param {string} - id of agency
//? @param {object} - carObject
//? @return {}

carMarket.setNewCarToAgency = function (id) {
  agency = carMarket.getAgencyById(id);
  agency.cars.push({
    brand: "Skoda",
    models: [
      {
        name: "Octavia",
        year: 2020,
        price: 942500,
        carNumber: "2IUsaMz",
        ownerId: "9KeaYbRLP",
      },
      {
        name: "Superb",
        year: 2020,
        price: 150300,
        carNumber: "1IsdaMz",
        ownerId: "9KeaYbRLP",
      },
    ],
  });
};

// carMarket.setNewCarToAgency("9KeaYbRLP");

//* deleteCarFromAgency
//? @param {string} - id of agency
//? @param {string} -  Car id
// ? @return {}

carMarket.deleteCarFromAgency = function (id, carNumber) {
  agency = carMarket.getAgencyById(id);
  agency.cars.forEach((car) => {
    const carsArray = car.models.filter((car) => car.carNumber !== carNumber);
    car.models = carsArray;
  });
};
// carMarket.deleteCarFromAgency("Plyq5M5AZ", "AZJZ4");

//* decrementOrIncrementCashOfAgency
//? @param {string} - agencyId
//? @param {number} - amount - negative or positive amount
// ? @return {number} - agencyCash

carMarket.decrementOrIncrementCashOfAgency = function (id, amount) {
  agency = carMarket.getAgencyById(id);
  if (agency && typeof amount === "number") {
    agency.cash += amount;
    return agency.cash;
  }
};
// console.log(carMarket.decrementOrIncrementCashOfAgency("Plyq5M5AZ", -225200));

//* decrementOrIncrementCreditOfAgency
//? @param {string} - agencyId
//? @param {number} - amount - negative or positive amount
// ? @return {number} - agencyCredit

carMarket.decrementOrIncrementCreditOfAgency = function (id, amount) {
  agency = carMarket.getAgencyById(id);
  if (agency && typeof amount === "number") {
    agency.credit += amount;
    return agency.credit;
  }
};

// console.log(carMarket.decrementOrIncrementCreditOfAgency("Plyq5M5AZ", 500));

//* setAmountOfCarsToBuyToAllAgency's
//? set a new property amountOfCars to all agency's, that represent the amount of cars available in the agency.
//? @param {}
// ? @return {objects[]} - sellers - array of all agency's

carMarket.setAmountOfCarsToBuyToAllAgency = function () {
  for (const agency of carMarket.sellers) {
    agency.amountOfCars = 0;
    agency.cars.forEach((car) => {
      agency.amountOfCars += car.models.length;
    });
  }
};
// carMarket.setAmountOfCarsToBuyToAllAgency();

//todo setters
//* setCarToCostumer
//? @param {string} - costumerId
//? @param {object} - carObject
//? @return {object[]} - allCarsOfCostumer

carMarket.setCarToCostumer = function (id, car) {
  customer = carMarket.getCustomerById(id);
  customer.cars.push(car);

  return customer.cars;
};

carMarket.setCarToCostumer("BGzHhjnE8", {
  name: "Corolla",
  year: 2020,
  price: 111570,
  carNumber: "81ba1",
  ownerId: "BGzHhjnE8",
});

//* deleteCarOfCostumer
//? @param {string} - costumerId
//? @param {string} - carId
//? @return {object[]} - allCarsOfCostumer

carMarket.deleteCarOfCostumer = function (id, carId) {
  customer = carMarket.getCustomerById(id);
  const allCars = customer.cars.filter((car) => {
    return car.carNumber !== carId;
  });
  customer.cars = allCars;
  return allCars;
};
carMarket.deleteCarOfCostumer("2RprZ1dbL", "WIh0U");
// console.log(carMarket.deleteCarOfCostumer("2RprZ1dbL", "WIh0U"));

//* decrementOrIncrementCashOfCostumer
//? @param {string} - costumerId
//? @param {number} - amount - negative or positive amount
// ? @return {number} - costumerCash

carMarket.decrementOrIncrementCashOfCostumer = function (id, amount) {
  customer = carMarket.getCustomerById(id);
  if (customer && typeof amount === "number") {
    customer.cash += amount;
    return customer.cash.toFixed();
  }
};

carMarket.decrementOrIncrementCashOfCostumer("2RprZ1dbL", 10000);
//! -------------------------------------------------------
//* 2) sortAndFilterByYearOfProduction
//?   filter and Sort in a Ascending or Descending order all vehicles for sale by year of production.
//?   @param {object[]} - arrOfCars - array of cars
//?   @param {number} - fromYear - Will display vehicles starting this year
//?   @param {number} - toYear - Will display vehicles up to this year
//?   @param {boolean} - isAscendingOrder - true for ascending order, false for descending order
//?   @return {object[]} - arrayOfModels - array of sorted cars

carMarket.sortAndFilterByYearOfProduction = function (
  arrayOfCars,
  fromYear,
  toYear,
  isAscendingOrder
) {
  let arrayOfModel = [];
  arrayOfCars.forEach((ele) => {
    ele.models.forEach((car) => {
      if (car.year >= fromYear && car.year <= toYear) arrayOfModel.push(car);
    });
  });

  if (isAscendingOrder) arrayOfModel.sort((a, b) => a.year - b.year);
  else arrayOfModel.sort((a, b) => b.year - a.year);
  return arrayOfModel;
  // console.log(arrayOfModel);

  // for (const iterator of arrayOfCars) {
  //   const arrayOfCarsInRange = iterator.models.filter((e) => {
  //     return e.year >= fromYear && e.year <= toYear;
  //   });
  //   console.log(arrayOfCarsInRange);
  // }
};

// carMarket.sortAndFilterByYearOfProduction = function (fromYear, toYear, isAscendingOrder) {
//   const arrayOfCars = [];
//   for (seller of this.sellers) {
//     for (car of seller.cars) {
//       for (model of car.models) {
//         arrayOfCars.push(model);
//       }
//     }
//   }
//   // console.log(arrayOfCars); //?Good
//------------Benny`s solution------------
// carMarket.sortAndFilterByYearOfProduction = function (fromYear, toYear, isAscendingOrder) {
//   const arrayOfCars = [];
//   for (seller of this.sellers) {
//     for (car of seller.cars) {
//       for (model of car.models) {
//         arrayOfCars.push(model);
//       }
//     }
//   }
//   // console.log(arrayOfCars); //?Good

//   const arrayOfCarsByYear = arrayOfCars.filter((car) => car.year >= fromYear && car.year < toYear);
//   // console.log(arrayOfCarsByYear);
//   if (isAscendingOrder) {
//     return arrayOfCarsByYear.sort((a, b) => a.year - b.year);
//   }
//   return arrayOfCarsByYear.sort((a, b) => b.year - a.year);
// };
//------------Benny`s solution end---------

carMarket.sortAndFilterByYearOfProduction(
  carMarket.allCarsToBuy(),
  2015,
  2019,
  true
);
//* 3) sortAndFilterByPrice
//?   filter and Sort in a Ascending or Descending order all vehicles for sale by price of the cars.
//?   @param {object[]} - arrOfCars - array of cars
//?   @param {number} - fromPrice - Will display vehicles starting at this price
//?   @param {number} - fromPrice - Will display vehicles up to this price
//?   @param {boolean} - isAscendingOrder - true for ascending order, false for descending order
//?   @return {object[]} - arrayOfModels - array of sorted cars

carMarket.sortAndFilterByPrice = function (
  arrayOfCars,
  fromPrice,
  toPrice,
  isAscendingOrder
) {
  let arrayOfModel = [];
  arrayOfCars.forEach((ele) => {
    ele.models.forEach((model) => {
      arrayOfModel.push(model);
    });
  });
  arrayOfModel = arrayOfModel.filter((car) => {
    return car.price >= fromPrice && car.price <= toPrice;
  });

  if (isAscendingOrder) arrayOfModel.sort((a, b) => a.price - b.price);
  else arrayOfModel.sort((a, b) => b.price - a.price);
  return arrayOfModel;
};

// carMarket.sortAndFilterByPrice(carMarket.allCarsToBuy(), 55000, 85000, true);

//* 4 ) searchCar
//?   @param {object[]} - arrOfCars - array of cars
//?   @param {number} - fromYear - Will display vehicles starting this year
//?   @param {number} - toYear - Will display vehicles up to this year
//?   @param {number} - fromPrice - Will display vehicles starting at this price
//?   @param {number} - fromPrice - Will display vehicles up to this price
//?   optional @param {string} - brand - Look only for cars of this brand

carMarket.searchCar = function (
  arrayOfCars,
  fromYear,
  toYear,
  fromPrice,
  toPrice,
  brand
) {
  const arrayByYear = carMarket.sortAndFilterByYearOfProduction(
    arrayOfCars,
    fromYear,
    toYear
  );

  let arrayByYearAndPrice = arrayByYear
    .filter((car) => {
      // console.log(car.brand);
      return car.price >= fromPrice && car.price <= toPrice;
    })
    .filter((car) => car.brand === brand);
  // console.log(arrayByYearAndPrice);
};

carMarket.searchCar(
  carMarket.allCarsToBuy(),
  2010,
  2015,
  25000,
  50000,
  "Chevrolet"
);

//* 5 ) sellCar
//?   Sell ​​a car to a specific customer
//?   @param {string} - agencyId
//?   @param {string} - customerId
//?   @param {string} - carModel
//?   @return {object} - The object of the car purchased by the customer or an explanation message
// *     - 5a. Subtract the vehicle amount + 17% (tax) from the customer's cash.
// *     - 5b. Add the vehicle value to the car agency cash.
// *     - 5c. Change the car owner's id to the customer's id.
// *     - 5d. Remove the car from the array of the agency's car models.
// *     - 5e. Add the car to the client cars array.
// *
// *     Taxes Authority:
// *     - 5f. Pay 17 percent of the vehicle value to the tax authority. (add the amount to totalTaxesPaid)
// *     - 5g. Increase the number of transactions made in one (numberOfTransactions)
// *     - 5h. Add the vehicle amount + tax to sumOfAllTransactions
// !     - Check that there is the requested vehicle at the agency in not return 'The vehicle does not exist at the agency'
// !     - Check that the customer has enough money to purchase the vehicle, if not return 'The customer does not have enough money'

//!      - Try to divide the tasks into several functions and try to maintain a readable language.

carMarket.sellCar = function (agencyId, customerId, carModel) {
  const agencyModelCars = carMarket.getAllCarToBuyByAgencyId(agencyId);
  const carsFromAgency = [];
  const customer = carMarket.getCustomerById(customerId);

  agencyModelCars.forEach((carObj) => {
    carObj.forEach((car) => {
      carsFromAgency.push(car);
    });
  });

  const carToBuy = carsFromAgency.find((car) => car.name === carModel);
  if (carToBuy) {
    if (customer.cash >= carToBuy.price) {
      carMarket.decrementOrIncrementCashOfCostumer(
        customerId,
        -(carToBuy.price * 1.17)
      );
      carMarket.decrementOrIncrementCashOfAgency(agencyId, carToBuy.price);

      carToBuy.ownerId = customerId;
      customer.cars.push(carToBuy);
      carMarket.deleteCarFromAgency(agencyId, carToBuy.carNumber);

      carMarket.taxesAuthority.totalTaxesPaid = carToBuy.price * 0.17;
      carMarket.taxesAuthority.numberOfTransactions++;
      carMarket.taxesAuthority.sumOfAllTransactions = carToBuy.price * 1.17;
      return carToBuy;
    } else return "The customer does not have enough money";
  }
  return "The vehicle does not exist at the agency";
};

console.log(carMarket.sellCar("26_IPfHU1", "pAuFtn_WA", "Hilux"));
